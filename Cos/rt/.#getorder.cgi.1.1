#!/usr/bin/perl
#
# Used by printreport.java
#
use DBI;
use CGI qw/:standard/;
use MIME::Base64;
use Cos::std;
use Cos::Dbh;

print "Content-type: text/plain\n\n";

my($orderid) = param( 'order' );

my($ref) = Cos::std::load($orderid);

##output properties
print "file_version:1.0\n";
print "agent_name:$ref->{'agent_name'}\n"; 	delete $ref->{'agent_name'};
print "agent_version:$ref{'agent_version'}\n";	delete $ref->{'agent_version'};

$efw->{trace_size} = length($ref->{trace_value});
$ref->{trace_value} = encode_base64($ref->{trace_value}, '');

foreach $key (sort keys %$ref) {
	$value = $ref->{$key};

	if ( $key =~ /extra_info/ ) {
		print "$value";
		next;
	}

	next if $key =~ /item_list/;

#	if ($key =~ /date/) {
#		($yr,$mo,$da,$hr,$min) = $value =~ /(....)(..)(..)(..)(..)/;
#		print "$key:$yr-$mo-$da $hr:$min\n";
#		next;
#	}

	print "$key:$value\n" if defined $value;
}

my($list) = $ref->{item_list};

my($id) = 0;
foreach my $item (@$list) {
	++$id;

	foreach $key (sort keys %$item) {
		print "$key_$id:$value\n" if defined $value;
	}
}
	

my($retailer) = sql("select name from retailer where user_id = ?", $ref->{cust_num});

print "name:$retailer->{name}\n";
